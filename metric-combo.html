<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script crossorigin src="https://cdn.jsdelivr.net/npm/keen-analysis@3/dist/keen-analysis.min.js"></script>
  <script crossorigin src="https://cdn.jsdelivr.net/npm/keen-dataviz@3.13.4/dist/keen-dataviz.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/keen-dataviz@3.13.4/dist/keen-dataviz.min.css">
</head>
<body>
  <div id="metric" style="height: 500px;"></div>
  <script>
    function showData() {
      // const intervalTime = 5000; // interval 5000ms
      const client = new KeenAnalysis({
        projectId: '',
        readKey: ''
      });

      const fetchResultsAndRender = () => {
        client
          .query({
            analysisType: 'extraction',
            eventCollection: '',
            timeframe: "this_1_minutes",
            timezone: -28800,
            propertyNames: ["prop1","prop2"],
            latest: "2",
          })
          .then((results) => {
            if (results.result.length > 1) {
              const chart = new KeenDataviz({
                container: '#metric',
                title: 'Target Metric Name',
                type: 'metric',
                isExtraction: true, // needed for metric chart to recognize this case
                comparedProp: 'prop1', // defines result
                showLoadingSpinner: true,
                palette: 'modern',
                clearOnRender: true,
                transition: {
                  duration: 0
                },
                prettyNumber: false,
                results,
              });
            }
          })
          .catch(error => console.log(error));
      }

      setInterval( () => {
          fetchResultsAndRender();
      }, intervalTime);

      fetchResultsAndRender();
  }

  window.addEventListener('load', () => {
    showData();
  });

  </script>
</body>
</html>
